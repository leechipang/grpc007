{"remainingRequest":"D:\\phpstudy_pro\\WWW\\master\\view\\admin\\node_modules\\vue-loader\\lib\\index.js??vue-loader-options!D:\\phpstudy_pro\\WWW\\master\\view\\admin\\src\\views\\cms\\addArticle\\index.vue?vue&type=script&lang=js&","dependencies":[{"path":"D:\\phpstudy_pro\\WWW\\master\\view\\admin\\src\\views\\cms\\addArticle\\index.vue","mtime":1601293043000},{"path":"D:\\phpstudy_pro\\WWW\\master\\view\\admin\\node_modules\\cache-loader\\dist\\cjs.js","mtime":499162500000},{"path":"D:\\phpstudy_pro\\WWW\\master\\view\\admin\\node_modules\\babel-loader\\lib\\index.js","mtime":315532800000},{"path":"D:\\phpstudy_pro\\WWW\\master\\view\\admin\\node_modules\\cache-loader\\dist\\cjs.js","mtime":499162500000},{"path":"D:\\phpstudy_pro\\WWW\\master\\view\\admin\\node_modules\\vue-loader\\lib\\index.js","mtime":499162500000}],"contextDependencies":[],"result":["//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n\nimport { articleListApi, articleAddApi, articleDetailApi, articleEditApi } from '@/api/cms'\nimport ueditorFrom from '@/components/ueditorFrom'\nimport { roterPre } from '@/settings'\nexport default {\n  name: 'EditArticle',\n  components: { ueditorFrom },\n  data() {\n    const validateUpload = (rule, value, callback) => {\n      if (this.formValidate.image_input) {\n        callback()\n      } else {\n        callback(new Error('请上传图文封面'))\n      }\n    }\n    const validateUpload2 = (rule, value, callback) => {\n      if (!this.formValidate.cid) {\n        callback(new Error('请选择文章分类'))\n      } else {\n        callback()\n      }\n    }\n    return {\n      roterPre: roterPre,\n      sleOptions: {\n        title: '',\n        article_category_id: ''\n      },\n      defaultProps: {\n        children: 'children',\n        label: 'title'\n      },\n      list: [],\n      treeData: [],\n      grid: {\n        xl: 10,\n        lg: 10,\n        md: 10,\n        sm: 24,\n        xs: 24\n      },\n      formValidate: {\n        cid: '',\n        title: '',\n        author: '',\n        image_input: '',\n        content: '',\n        synopsis: '',\n        url: '',\n        is_hot: 0,\n        is_banner: 0,\n        status: 0\n      },\n      ruleValidate: {\n        title: [\n          { required: true, message: '请输入标题', trigger: 'blur' }\n        ],\n        author: [\n          { required: true, message: '请输入作者', trigger: 'blur' }\n        ],\n        cid: [\n          { required: true, validator: validateUpload2, trigger: 'change' }\n        ],\n        image_input: [\n          { required: true, validator: validateUpload, trigger: 'change' }\n        ],\n        content: [\n          { required: true, message: '请输入文章内容', trigger: 'change' }\n        ]\n      },\n      tempRoute: {}\n    }\n  },\n  watch: {\n    $route(to, from) {\n      if (this.$route.params.id) {\n        this.getDetails()\n      } else {\n        this.formValidate = {\n          title: '',\n          author: '',\n          image_input: '',\n          content: '',\n          synopsis: '',\n          url: '',\n          is_hot: 0,\n          is_banner: 0,\n          status: 0\n        }\n      }\n    }\n  },\n  created() {\n    this.tempRoute = Object.assign({}, this.$route)\n  },\n  mounted() {\n    this.getList()\n    if (this.$route.params.id) {\n      this.setTagsViewTitle()\n      this.getDetails()\n    }\n  },\n  methods: {\n    // 返回\n    back() {\n      this.$router.push({ path: `${roterPre}/cms/article` })\n    },\n    // 所有分类\n    getList() {\n      articleListApi().then(res => {\n        this.treeData = res.data\n      }).catch(res => {\n        this.$message.error(res.message)\n      })\n    },\n    modalPicTap(tit) {\n      const _this = this\n      this.$modalUpload(function(img) {\n        _this.formValidate.image_input = img[0]\n      }, tit)\n    },\n    // 分类点击\n    handleSelClick(node) {\n      this.formValidate.cid = node.article_category_id\n      this.sleOptions = {\n        title: node.title,\n        article_category_id: node.article_category_id\n      }\n    },\n    // 提交数据\n    onsubmit(name) {\n      this.$refs[name].validate((valid) => {\n        if (valid) {\n          if (this.$route.params.id) {\n            articleEditApi(this.formValidate, this.$route.params.id).then(async res => {\n              this.$message.success(res.message)\n              setTimeout(() => {\n                this.$router.push({ path: `${roterPre}/cms/article` })\n              }, 500)\n            }).catch(res => {\n              this.$message.error(res.message)\n            })\n          } else {\n            articleAddApi(this.formValidate).then(async res => {\n              this.$message.success(res.message)\n              setTimeout(() => {\n                this.$router.push({ path: `${roterPre}/cms/article` })\n              }, 500)\n            }).catch(res => {\n              this.$message.error(res.message)\n            })\n          }\n        } else {\n          return false\n        }\n      })\n    },\n    // 文章详情\n    getDetails() {\n      articleDetailApi(this.$route.params.id ? this.$route.params.id : 0).then(async res => {\n        const news = res.data\n        this.sleOptions.title = news.articleCategory.title\n        this.sleOptions.article_category_id = news.articleCategory.article_category_id\n        this.formValidate = {\n          cid: news.articleCategory.article_category_id,\n          title: news.title,\n          author: news.author,\n          image_input: news.image_input,\n          content: news.content.content,\n          synopsis: news.synopsis,\n          url: news.url,\n          is_hot: news.is_hot,\n          is_banner: news.is_banner,\n          status: news.status\n        }\n      }).catch(res => {\n        this.loading = false\n        this.$message.error(res.message)\n      })\n    },\n    setTagsViewTitle() {\n      const title = '编辑文章'\n      const route = Object.assign({}, this.tempRoute, { title: `${title}-${this.$route.params.id}` })\n      this.$store.dispatch('tagsView/updateVisitedView', route)\n    }\n  }\n}\n",null]}