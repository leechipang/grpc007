{"remainingRequest":"D:\\phpstudy_pro\\WWW\\master\\view\\admin\\node_modules\\vue-loader\\lib\\index.js??vue-loader-options!D:\\phpstudy_pro\\WWW\\master\\view\\admin\\src\\views\\app\\wechat\\newsCategory\\save.vue?vue&type=script&lang=js&","dependencies":[{"path":"D:\\phpstudy_pro\\WWW\\master\\view\\admin\\src\\views\\app\\wechat\\newsCategory\\save.vue","mtime":1609299900000},{"path":"D:\\phpstudy_pro\\WWW\\master\\view\\admin\\node_modules\\cache-loader\\dist\\cjs.js","mtime":499162500000},{"path":"D:\\phpstudy_pro\\WWW\\master\\view\\admin\\node_modules\\babel-loader\\lib\\index.js","mtime":315532800000},{"path":"D:\\phpstudy_pro\\WWW\\master\\view\\admin\\node_modules\\cache-loader\\dist\\cjs.js","mtime":499162500000},{"path":"D:\\phpstudy_pro\\WWW\\master\\view\\admin\\node_modules\\vue-loader\\lib\\index.js","mtime":499162500000}],"contextDependencies":[],"result":["//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n\nimport ueditorFrom from '@/components/ueditorFrom'\nimport { wechatNewsAddApi, wechatNewsInfotApi, wechatNewsUpdateApi } from '@/api/app'\nimport { roterPre } from '@/settings'\nexport default {\n  name: 'Save',\n  components: { ueditorFrom },\n  data() {\n    const validateUpload = (rule, value, callback) => {\n      if (this.saveForm.image_input) {\n        callback()\n      } else {\n        callback(new Error('请上传图文封面'))\n      }\n    }\n    return {\n      roterPre: roterPre,\n      ruleValidate: {\n        title: [\n          { required: true, message: '请输入标题', trigger: 'blur' }\n        ],\n        author: [\n          { required: true, message: '请输入作者', trigger: 'blur' }\n        ],\n        image_input: [\n          { required: true, validator: validateUpload, trigger: 'change' }\n        ],\n        content: [\n          { required: true, message: '请输入正文', trigger: 'change' }\n        ],\n        synopsis: [\n          { required: true, message: '请输入文章摘要', trigger: 'blur' }\n        ]\n      },\n      isChoice: '单选',\n      dragging: null,\n      isDel: false,\n      msg: '',\n      count: [],\n      baseImg: require('../../../../assets/images/bjt.png'),\n      saveForm: {\n        title: '',\n        author: '',\n        synopsis: '',\n        image_input: '',\n        content: ''\n      },\n      current: 0,\n      data: [\n        {\n          title: '',\n          author: '',\n          synopsis: '',\n          image_input: '',\n          content: ''\n        }\n      ],\n      uploadList: [],\n      modalPic: false,\n      gridPic: {\n        xl: 6,\n        lg: 8,\n        md: 12,\n        sm: 12,\n        xs: 12\n      },\n      gridBtn: {\n        xl: 4,\n        lg: 8,\n        md: 8,\n        sm: 8,\n        xs: 8\n      }\n    }\n  },\n  watch: {\n    $route(to, from) {\n      if (this.$route.params.id) {\n        this.info()\n      }\n    }\n  },\n  mounted() {\n    if (this.$route.params.id) {\n      this.info()\n    }\n  },\n  methods: {\n    modalPicTap() {\n      const _this = this\n      _this.$modalUpload(function(img) {\n        _this.saveForm.image_input = img[0]\n      })\n    },\n    // 添加图文按钮\n    handleAdd() {\n      if (!this.check()) return false\n      const obj = {\n        title: '',\n        author: '',\n        synopsis: '',\n        image_input: '',\n        content: ''\n      }\n      this.data.push(obj)\n    },\n    // 点击模块\n    onSubSave(i) {\n      this.current = i\n      this.data.map((item, index) => {\n        /* eslint-disable */\n        if (index === this.current){\n          this.saveForm = this.data[this.current];\n        }\n      })\n    },\n    // 删除\n    del (i) {\n      if (i === 0) {\n        this.$message.warning('不能再删除了');\n      } else {\n        this.data.splice(i, 1);\n        this.saveForm = {};\n      }\n    },\n    // 详情\n    info () {\n      wechatNewsInfotApi(this.$route.params.id).then(async res => {\n        let info = res.data;\n        this.data = info.article\n        this.data.map(item => {\n          item.content = item.content.content\n        })\n        this.saveForm = this.data[this.current]\n      }).catch(res => {\n        this.$message.error(res.message);\n      })\n    },\n    // 提交数据\n    subFrom (name) {\n      this.$refs[name].validate((valid) => {\n        if (valid) {\n          let data = [this.saveForm]\n          data = this.current === '' ? data : this.data\n          this.$route.params.id ? wechatNewsUpdateApi(this.$route.params.id,this.data).then(async res => {\n            this.$message.success(res.message);\n            setTimeout(() => {\n              this.$router.push({ path: `${roterPre}/app/wechat/newsCategory` });\n            }, 500);\n          }).catch(res => {\n            this.$message.error(res.message);\n          }) : wechatNewsAddApi([this.saveForm]).then(async res => {\n            this.$message.success(res.message);\n            setTimeout(() => {\n              this.$router.push({ path: `${roterPre}/app/wechat/newsCategory` });\n            }, 500);\n          }).catch(res => {\n            this.$message.error(res.message);\n          })\n        } else {\n          return false;\n        }\n      })\n    },\n    check () {\n      for (let index in this.data){\n        if(!this.data[index].title){\n          this.$message.warning('请输入文章的标题');\n          return false;\n        }\n        else if(!this.data[index].author){\n          this.$message.warning('请输入文章的作者');\n          return false;\n        }\n        else if(!this.data[index].synopsis){\n          this.$message.warning('请输入文章的摘要');\n          return false;\n        }\n        else if(!this.data[index].image_input){\n          this.$message.warning('请输入文章的图文封面');\n          return false;\n        }\n        else if(!this.data[index].content){\n          this.$message.warning('请输入文章的内容');\n          return false;\n        }else{\n          return true\n        }\n      }\n    }\n  }\n}\n",null]}