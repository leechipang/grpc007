{"remainingRequest":"D:\\phpstudy_pro\\WWW\\master\\view\\admin\\node_modules\\vue-loader\\lib\\index.js??vue-loader-options!D:\\phpstudy_pro\\WWW\\master\\view\\admin\\src\\views\\maintain\\dataBackup\\index.vue?vue&type=script&lang=js&","dependencies":[{"path":"D:\\phpstudy_pro\\WWW\\master\\view\\admin\\src\\views\\maintain\\dataBackup\\index.vue","mtime":1612520340000},{"path":"D:\\phpstudy_pro\\WWW\\master\\view\\admin\\node_modules\\cache-loader\\dist\\cjs.js","mtime":499162500000},{"path":"D:\\phpstudy_pro\\WWW\\master\\view\\admin\\node_modules\\babel-loader\\lib\\index.js","mtime":315532800000},{"path":"D:\\phpstudy_pro\\WWW\\master\\view\\admin\\node_modules\\cache-loader\\dist\\cjs.js","mtime":499162500000},{"path":"D:\\phpstudy_pro\\WWW\\master\\view\\admin\\node_modules\\vue-loader\\lib\\index.js","mtime":499162500000}],"contextDependencies":[],"result":["//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n\r\nimport { fileListApi, databaseListApi, backupsApi, optimizeApi, repairApi, detailApi, downloadApi, fileListDeleteApi } from '@/api/maintain'\r\nimport SettingMer from '@/libs/settingMer'\r\nimport { getToken } from '@/utils/auth'\r\nexport default {\r\n  name: 'DataBackup',\r\n  data() {\r\n    return {\r\n      tableData: {\r\n        data: []\r\n      },\r\n      databaseData: {\r\n        data: []\r\n      },\r\n      listLoading: false,\r\n      listLoading1: false,\r\n      selectionList: [],\r\n      dataList: {},\r\n      dialogVisible: false,\r\n      tabList: [],\r\n      rows: {}\r\n    }\r\n  },\r\n  mounted() {\r\n    this.getList()\r\n    this.getListDatabase()\r\n  },\r\n  methods: {\r\n    exportData() {\r\n      const formValidate = this.formValidate\r\n      const data = {\r\n        is_show: formValidate.is_show,\r\n        store_name: formValidate.store_name\r\n      }\r\n      storeCombinationApi(data).then(res => {\r\n        location.href = res.data[0]\r\n      }).catch(res => {\r\n        this.$message.error(res.message)\r\n      })\r\n    },\r\n    download(feilname) {\r\n      window.open(SettingMer.https + `/safety/database/download/${feilname}?token=` + getToken())\r\n      // downloadApi(feilname).then(async res => {\r\n      //   console.log(res)\r\n      //   // let blob = new Blob([res], { type: 'application/vnd.ms-excel' }); // res就是接口返回的文件流了\r\n      //   const blob = new Blob([res], { type: 'application/zip' })\r\n      //   const objectUrl = URL.createObjectURL(blob)\r\n      //   console.log(objectUrl)\r\n      //   window.location.href = objectUrl\r\n      // }).catch(res => {\r\n      //   console.log(res)\r\n      //   this.$message.error(res.message)\r\n      // })\r\n    },\r\n    handleClose() {\r\n      this.dialogVisible = false\r\n    },\r\n    handleSelectionChange(val) {\r\n      this.selectionList = val\r\n      const tables = []\r\n      this.selectionList.map((item) => {\r\n        tables.push(item.name)\r\n      })\r\n      this.dataList = {\r\n        name: tables\r\n      }\r\n    },\r\n    // 详情\r\n    Info(row) {\r\n      this.rows = row\r\n      this.dialogVisible = true\r\n      this.listLoading = true\r\n      detailApi(row.name).then(async res => {\r\n        this.tabList = res.data\r\n        this.listLoading = false\r\n      }).catch(res => {\r\n        this.listLoading = false\r\n        this.$message.error(res.message)\r\n      })\r\n    },\r\n    // 备份表\r\n    getBackup() {\r\n      if (this.selectionList.length === 0) {\r\n        return this.$message.warning('请选择表')\r\n      }\r\n      this.$modalSure('是否备份数据库表').then(() => {\r\n        backupsApi(this.dataList).then(async res => {\r\n          this.$message.success(res.message)\r\n        }).catch(res => {\r\n          this.loading = false\r\n          this.$message.error(res.message)\r\n        })\r\n      })\r\n    },\r\n    // 优化表\r\n    getOptimize() {\r\n      if (this.selectionList.length === 0) {\r\n        return this.$message.warning('请选择表')\r\n      }\r\n      this.$modalSure('是否优化数据库表').then(() => {\r\n        optimizeApi(this.dataList).then(async res => {\r\n          this.$message.success(res.message)\r\n        }).catch(res => {\r\n          this.$message.error(res.message)\r\n        })\r\n      })\r\n    },\r\n    // 修复表\r\n    getRepair() {\r\n      if (this.selectionList.length === 0) {\r\n        return this.$message.warning('请选择表')\r\n      }\r\n      this.$modalSure('是否修复数据库表').then(() => {\r\n        repairApi(this.dataList).then(async res => {\r\n          this.$message.success(res.message)\r\n        }).catch(res => {\r\n          this.$message.error(res.message)\r\n        })\r\n      })\r\n    },\r\n    // 列表\r\n    getList() {\r\n      this.listLoading1 = true\r\n      fileListApi().then(res => {\r\n        this.tableData.data = res.data\r\n        this.listLoading1 = false\r\n      }).catch(res => {\r\n        this.listLoading1 = false\r\n        this.$message.error(res.message)\r\n      })\r\n    },\r\n    // 数据库表列表\r\n    getListDatabase() {\r\n      this.listLoading = true\r\n      databaseListApi().then(res => {\r\n        this.databaseData.data = res.data\r\n        this.listLoading = false\r\n      }).catch(res => {\r\n        this.listLoading = false\r\n        this.$message.error(res.message)\r\n      })\r\n    },\r\n    // 删除\r\n    handleDelete(time, idx) {\r\n      this.$modalSure().then(() => {\r\n        fileListDeleteApi({feilname: time}).then(({ message }) => {\r\n          this.$message.success(message)\r\n          this.getList()\r\n        }).catch(({ message }) => {\r\n          this.$message.error(message)\r\n        })\r\n      })\r\n    }\r\n  }\r\n}\r\n",null]}