{"remainingRequest":"D:\\phpstudy_pro\\WWW\\master\\view\\admin\\node_modules\\vue-loader\\lib\\index.js??vue-loader-options!D:\\phpstudy_pro\\WWW\\master\\view\\admin\\src\\views\\marketing\\combination\\combination_goods\\detail.vue?vue&type=script&lang=js&","dependencies":[{"path":"D:\\phpstudy_pro\\WWW\\master\\view\\admin\\src\\views\\marketing\\combination\\combination_goods\\detail.vue","mtime":1612255397000},{"path":"D:\\phpstudy_pro\\WWW\\master\\view\\admin\\node_modules\\cache-loader\\dist\\cjs.js","mtime":499162500000},{"path":"D:\\phpstudy_pro\\WWW\\master\\view\\admin\\node_modules\\babel-loader\\lib\\index.js","mtime":315532800000},{"path":"D:\\phpstudy_pro\\WWW\\master\\view\\admin\\node_modules\\cache-loader\\dist\\cjs.js","mtime":499162500000},{"path":"D:\\phpstudy_pro\\WWW\\master\\view\\admin\\node_modules\\vue-loader\\lib\\index.js","mtime":499162500000}],"contextDependencies":[],"result":["//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n\nimport { productStatusApi } from '@/api/product'\nimport { combinationProDetailApi } from '@/api/marketing'\nconst defaultObj = {\n  image: '',\n  slider_image: [],\n  store_name: '',\n  store_info: '',\n  keyword: '',\n  brand_id: '', // 品牌id\n  cate_id: '', // 平台分类id\n  mer_cate_id: [], // 商户分类id\n  unit_name: '',\n  sort: 0,\n  is_show: 0,\n  is_benefit: 0,\n  is_new: 0,\n  is_good: 0,\n  temp_id: '',\n  attrValue: [{\n    image: '',\n    price: null,\n    cost: null,\n    ot_price: null,\n    stock: null,\n    bar_code: '',\n    weight: null,\n    volume: null\n  }],\n  attr: [],\n  selectRule: '',\n  extension_type: 0,\n  content: '',\n  spec_type: 0\n}\nconst objTitle = {\n  price: {\n    title: '售价'\n  },\n  cost: {\n    title: '成本价'\n  },\n  ot_price: {\n    title: '原价'\n  },\n  stock: {\n    title: '库存'\n  },\n  bar_code: {\n    title: '商品编号'\n  },\n  weight: {\n    title: '重量（KG）'\n  },\n  volume: {\n    title: '体积(m³)'\n  }\n}\n\nexport default {\n  name: 'Info',\n  props: {\n    \n  },\n  data() {\n    return {\n      rules: {\n        status: [\n          { required: true, message: '请选择审核状态', trigger: 'change' }\n        ],\n        refusal: [\n          { required: true, message: '请填写拒绝原因', trigger: 'blur' }\n        ]\n      },\n      proId: 0,\n      ruleForm: {\n        refusal: '',\n        status: 1,\n        id: ''\n      },\n      formThead: Object.assign({}, objTitle),\n      manyTabDate: {},\n      manyTabTit: {},\n      loading: false,\n      dialogVisible: false,\n      activeNames: 'first',\n      formValidate: {},\n      attrInfo: {},\n      OneattrValue: [Object.assign({}, defaultObj.attrValue[0])], // 单规格\n      ManyAttrValue: [Object.assign({}, defaultObj.attrValue[0])] // 多规格\n    }\n  },\n  computed: {\n    attrValue() {\n      const obj = Object.assign({}, defaultObj.attrValue[0])\n      delete obj.image\n      return obj\n    },\n    oneFormBatch() {\n      const obj = [Object.assign({}, defaultObj.attrValue[0])]\n      delete obj[0].bar_code\n      return obj\n    }\n  },\n  methods: {\n    handleClose() {\n      this.dialogVisible = false\n      this.activeNames = 'first'\n    },\n    watCh(val) {\n      const tmp = {};\n      const tmpTab = {};\n      this.formValidate.attr.forEach((o, i) => {\n        tmp[\"value\" + i] = { title: o.value };\n        tmpTab[\"value\" + i] = \"\";\n      });\n      this.ManyAttrValue.forEach((val, index) => {\n        const key = Object.values(val.detail).sort().join(\"/\");\n        if (this.attrInfo[key]) this.ManyAttrValue[index] = this.attrInfo[key];\n      });\n      this.attrInfo = {};\n      this.ManyAttrValue.forEach((val) => {\n        this.attrInfo[Object.values(val.detail).sort().join(\"/\")] = val;\n      });\n      this.manyTabTit = tmp;\n      this.manyTabDate = tmpTab;\n      this.formThead = Object.assign({}, this.formThead, tmp);\n    },\n    getInfo(id) {\n      this.proId = id\n      this.loading = true\n      combinationProDetailApi(id).then(res => {\n        let info = res.data;\n        this.formValidate = {\n          product_id: info.product_id,\n          image: info.product.image,\n          store_name: info.product.store_name,\n          store_info: info.product.store_info,\n          start_time: info.start_time\n            ? info.start_time + \":00\"\n            : \"\",\n          end_time: info.end_time\n            ? info.end_time + \":00\"\n            : \"\",\n          unit_name: info.product.unit_name,\n          is_show: info.is_show,\n          stock: info.stock,\n          attr: info.product.attr,\n          spec_type: info.product.spec_type,\n          create_time: info.create_time,\n          product: info.product,\n          merchant: info.merchant,\n          status: info.product_status,\n          action_status: info.action_status,\n          price: info.price,\n          pay_count: info.pay_count,\n          once_pay_count: info.once_pay_count,\n          buying_count_num: info.buying_count_num,\n          success_num: info.success_num,\n          count_take: info.count_take,\n          count_user: info.count_user,\n          refusal: info.refusal\n        };\n\n       if (this.formValidate.spec_type === 0) {\n          this.OneattrValue = info.product.attrValue;\n          this.OneattrValue[0].active_price = this.OneattrValue[0]._sku ? this.OneattrValue[0]._sku.active_price : 0;\n          this.OneattrValue[0].sales = this.OneattrValue[0]._sku ? this.OneattrValue[0]._sku.sales : 0;\n        } else {\n          this.ManyAttrValue = []\n          info.product.attrValue.forEach((val,i) => {\n            // this.attrInfo[Object.values(val.detail).sort().join(\"/\")] = val;\n            if(val._sku){\n              this.$set(val,'active_price',val._sku.active_price)\n              this.$set(val,'sales',val._sku.sales ? val._sku.sales : 0)\n              this.ManyAttrValue.push(val)\n            }\n          });\n          this.watCh(this.formValidate.attr)\n        }\n        this.loading = false\n      }).catch(res => {\n        this.$message.error(res.message)\n        this.loading = false\n      })\n    }\n  }\n}\n",null]}