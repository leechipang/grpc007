{"remainingRequest":"D:\\phpstudy_pro\\WWW\\master\\view\\admin\\node_modules\\babel-loader\\lib\\index.js!D:\\phpstudy_pro\\WWW\\master\\view\\admin\\node_modules\\cache-loader\\dist\\cjs.js??ref--0-0!D:\\phpstudy_pro\\WWW\\master\\view\\admin\\node_modules\\vue-loader\\lib\\index.js??vue-loader-options!D:\\phpstudy_pro\\WWW\\master\\view\\admin\\src\\views\\merchant\\list\\record.vue?vue&type=script&lang=js&","dependencies":[{"path":"D:\\phpstudy_pro\\WWW\\master\\view\\admin\\src\\views\\merchant\\list\\record.vue","mtime":1617711255678},{"path":"D:\\phpstudy_pro\\WWW\\master\\view\\admin\\node_modules\\cache-loader\\dist\\cjs.js","mtime":499162500000},{"path":"D:\\phpstudy_pro\\WWW\\master\\view\\admin\\node_modules\\babel-loader\\lib\\index.js","mtime":315532800000},{"path":"D:\\phpstudy_pro\\WWW\\master\\view\\admin\\node_modules\\cache-loader\\dist\\cjs.js","mtime":499162500000},{"path":"D:\\phpstudy_pro\\WWW\\master\\view\\admin\\node_modules\\vue-loader\\lib\\index.js","mtime":499162500000}],"contextDependencies":[],"result":["\"use strict\";\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.default = void 0;\n\nrequire(\"core-js/modules/web.dom.iterable\");\n\nvar _merchant = require(\"@/api/merchant\");\n\nvar _accounts = require(\"@/api/accounts\");\n\nvar _settings = require(\"@/settings\");\n\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\nvar _default = {\n  name: 'Record',\n  data: function data() {\n    return {\n      roterPre: _settings.roterPre,\n      chkName: '',\n      chkNameRefund: '',\n      isIndeterminate: true,\n      resource: [],\n      visible: false,\n      timeVal: [],\n      pickerOptions: {\n        shortcuts: [{\n          text: '最近一周',\n          onClick: function onClick(picker) {\n            var end = new Date();\n            var start = new Date();\n            start.setTime(start.getTime() - 3600 * 1000 * 24 * 7);\n            picker.$emit('pick', [start, end]);\n          }\n        }, {\n          text: '最近一个月',\n          onClick: function onClick(picker) {\n            var end = new Date();\n            var start = new Date();\n            start.setTime(start.getTime() - 3600 * 1000 * 24 * 30);\n            picker.$emit('pick', [start, end]);\n          }\n        }, {\n          text: '最近三个月',\n          onClick: function onClick(picker) {\n            var end = new Date();\n            var start = new Date();\n            start.setTime(start.getTime() - 3600 * 1000 * 24 * 90);\n            picker.$emit('pick', [start, end]);\n          }\n        }]\n      },\n      listLoading: true,\n      tableData: {\n        data: [],\n        total: 0\n      },\n      tableDataRefund: {\n        data: [],\n        total: 0\n      },\n      tableFrom: {\n        page: 1,\n        limit: 10,\n        date: '',\n        status: ''\n      },\n      ids: [],\n      idsRefund: [],\n      checkedPage: [],\n      checkedIds: [],\n      // 订单当前页选中的数据\n      noChecked: [],\n      // 订单全选状态下当前页不选中的数据\n      refundCheckedIds: [],\n      // 退款单当前页选中的数据\n      refundNoChecked: [] // 退款单全选状态下当前页不选中的数据\n\n    };\n  },\n  mounted: function mounted() {\n    this.init();\n  },\n  created: function created() {\n    this.tempRoute = Object.assign({}, this.$route);\n  },\n  methods: {\n    isDisabled: function isDisabled(row) {\n      if (row.status !== 3) {\n        return false;\n      }\n\n      return true;\n    },\n    init: function init() {\n      this.tableFrom.page = 1;\n      this.getList();\n      this.getRefundList();\n\n      if (this.$route.params.type === 0) {\n        this.setTagsViewTitle();\n      }\n    },\n    // 订单\n    onHandle: function onHandle(name) {\n      this.chkName = this.chkName === name ? '' : name;\n      this.changeType(!(this.chkName === ''));\n    },\n    changeOne: function changeOne(v, order) {\n      if (v) {\n        if (this.chkName === 'duo') {\n          var index = this.noChecked.indexOf(order.order_id);\n          if (index > -1) this.noChecked.splice(index, 1);\n        } else {\n          var _index = this.checkedIds.indexOf(order.order_id);\n\n          if (_index === -1) this.checkedIds.push(order.order_id);\n        }\n      } else {\n        if (this.chkName === 'duo') {\n          var _index2 = this.noChecked.indexOf(order.order_id);\n\n          if (_index2 === -1) this.noChecked.push(order.order_id);\n        } else {\n          var _index3 = this.checkedIds.indexOf(order.order_id);\n\n          if (_index3 > -1) this.checkedIds.splice(_index3, 1);\n        }\n      }\n    },\n    changeType: function changeType(v) {\n      if (v) {\n        if (!this.chkName) {\n          this.chkName = 'dan';\n        }\n      } else {\n        this.chkName = '';\n      }\n\n      var index = this.checkedPage.indexOf(this.tableFrom.page);\n\n      if (this.chkName === 'dan') {\n        this.checkedPage.push(this.tableFrom.page);\n      } else if (index > -1) {\n        this.checkedPage.splice(index, 1);\n      }\n\n      this.syncCheckedId();\n    },\n    syncCheckedId: function syncCheckedId() {\n      var _this = this;\n\n      var ids = this.tableData.data.map(function (v) {\n        return v.order_id;\n      });\n\n      if (this.chkName === 'duo') {\n        this.checkedIds = [];\n      } else if (this.chkName === 'dan') {\n        ids.forEach(function (id) {\n          var index = _this.checkedIds.indexOf(id);\n\n          if (index === -1) {\n            _this.checkedIds.push(id);\n          }\n        });\n      } else {\n        ids.forEach(function (id) {\n          var index = _this.checkedIds.indexOf(id);\n\n          if (index > -1) {\n            _this.checkedIds.splice(index, 1);\n          }\n        });\n      }\n    },\n    // 退款订单\n    onHandleRefund: function onHandleRefund(name) {\n      this.chkNameRefund = this.chkNameRefund === name ? '' : name;\n      this.changeTypeRefund(!(this.chkNameRefund === ''));\n    },\n    changeOneRefund: function changeOneRefund(v, order) {\n      if (v) {\n        if (this.chkNameRefund === 'duo') {\n          var index = this.refundNoChecked.indexOf(order.refund_order_id);\n          if (index > -1) this.refundNoChecked.splice(index, 1);\n        } else {\n          var _index4 = this.refundCheckedIds.indexOf(order.refund_order_id);\n\n          if (_index4 === -1) this.refundCheckedIds.push(order.refund_order_id);\n        }\n      } else {\n        if (this.chkNameRefund === 'duo') {\n          var _index5 = this.refundNoChecked.indexOf(order.refund_order_id);\n\n          if (_index5 === -1) this.refundNoChecked.push(order.refund_order_id);\n        } else {\n          var _index6 = this.refundCheckedIds.indexOf(order.refund_order_id);\n\n          if (_index6 > -1) this.refundCheckedIds.splice(_index6, 1);\n        }\n      }\n    },\n    changeTypeRefund: function changeTypeRefund(v) {\n      if (v) {\n        if (!this.chkNameRefund) {\n          this.chkNameRefund = 'dan';\n        }\n      } else {\n        this.chkNameRefund = '';\n      }\n\n      var index = this.checkedPage.indexOf(this.tableFrom.page);\n\n      if (this.chkNameRefund === 'dan') {\n        this.checkedPage.push(this.tableFrom.page);\n      } else if (index > -1) {\n        this.checkedPage.splice(index, 1);\n      }\n\n      this.syncCheckedIdRefund();\n    },\n    syncCheckedIdRefund: function syncCheckedIdRefund() {\n      var _this2 = this;\n\n      var ids = this.tableDataRefund.data.map(function (v) {\n        return v.refund_order_id;\n      });\n\n      if (this.chkNameRefund === 'duo') {\n        this.refundCheckedIds = [];\n      } else if (this.chkNameRefund === 'dan') {\n        ids.forEach(function (id) {\n          var index = _this2.refundCheckedIds.indexOf(id);\n\n          if (index === -1) {\n            _this2.refundCheckedIds.push(id);\n          }\n        });\n      } else {\n        ids.forEach(function (id) {\n          var index = _this2.refundCheckedIds.indexOf(id);\n\n          if (index > -1) {\n            _this2.refundCheckedIds.splice(index, 1);\n          }\n        });\n      }\n    },\n    onAdd: function onAdd() {\n      var _this3 = this;\n\n      // if (this.ids.length === 0 || this.idsRefund.length === 0) return this.$message.warning('请先选择对账单')\n      var datas = {\n        order_ids: this.checkedIds,\n        order_out_ids: this.noChecked,\n        order_type: this.chkName === 'duo' ? 1 : 0,\n        refund_order_ids: this.refundCheckedIds,\n        refund_out_ids: this.refundNoChecked,\n        refund_type: this.chkNameRefund === 'duo' ? 1 : 0,\n        date: this.tableFrom.date\n      };\n      this.$modalSure('发起商户对账吗').then(function () {\n        (0, _merchant.reconciliationApi)(_this3.$route.params.id, datas).then(function (_ref) {\n          var message = _ref.message;\n\n          _this3.$message.success(message);\n\n          _this3.tableFrom.page = 1;\n\n          _this3.getList();\n\n          _this3.getRefundList();\n\n          _this3.chkName = '';\n          _this3.chkNameRefund = '';\n          _this3.refundCheckedIds = [];\n          _this3.checkedIds = [];\n          _this3.noChecked = [];\n          _this3.refundNoChecked = [];\n        }).catch(function (_ref2) {\n          var message = _ref2.message;\n\n          _this3.$message.error(message);\n        });\n      });\n    },\n    // 具体日期\n    onchangeTime: function onchangeTime(e) {\n      this.timeVal = e;\n      this.tableFrom.date = this.timeVal ? this.timeVal.join('-') : '';\n      this.tableFrom.page = 1;\n      this.getList();\n      this.getRefundList();\n    },\n    // 退款备注\n    onOrderMark: function onOrderMark(id) {\n      var _this4 = this;\n\n      this.$modalForm((0, _merchant.refundMarkApi)(id)).then(function () {\n        return _this4.getRefundList();\n      });\n    },\n    // 订单备注\n    addMark: function addMark(id) {\n      var _this5 = this;\n\n      this.$modalForm((0, _merchant.orderMarkApi)(id)).then(function () {\n        return _this5.getList();\n      });\n    },\n    getTotalRefund: function getTotalRefund(row) {\n      var sum = 0;\n\n      for (var i = 0; i < row.length; i++) {\n        sum += row[i].product.cart_info.productAttr.price * row[i].refund_num;\n      }\n\n      return sum;\n    },\n    getTotal: function getTotal(row) {\n      var sum = 0;\n\n      for (var i = 0; i < row.length; i++) {\n        sum += row[i].cart_info.productAttr.price * row[i].product_num;\n      }\n\n      return sum;\n    },\n    // 列表\n    getList: function getList() {\n      var _this6 = this;\n\n      this.listLoading = true;\n      this.$route.params.type === '1' ? (0, _merchant.merOrderListApi)(this.$route.params.id, this.tableFrom).then(function (res) {\n        _this6.tableData.data = res.data.list;\n        _this6.tableData.total = res.data.count;\n\n        _this6.tableData.data.map(function (item) {\n          _this6.$set(item, {\n            checked: false\n          });\n        });\n\n        _this6.listLoading = false;\n      }).catch(function (res) {\n        _this6.listLoading = false;\n\n        _this6.$message.error(res.message);\n      }) : (0, _accounts.reconciliationOrderApi)(this.$route.params.id, this.tableFrom).then(function (res) {\n        _this6.tableData.data = res.data.list;\n        _this6.tableData.total = res.data.count;\n\n        _this6.tableData.data.map(function (item) {\n          _this6.$set(item, {\n            checked: false\n          });\n        });\n\n        _this6.listLoading = false;\n      }).catch(function (res) {\n        _this6.listLoading = false;\n\n        _this6.$message.error(res.message);\n      });\n    },\n    pageChange: function pageChange(page) {\n      this.tableFrom.page = page;\n      this.getList();\n    },\n    handleSizeChange: function handleSizeChange(val) {\n      this.tableFrom.limit = val;\n      this.chkName = '';\n      this.getList();\n    },\n    // 退款列表\n    getRefundList: function getRefundList() {\n      var _this7 = this;\n\n      this.listLoading = true;\n      this.$route.params.type === '1' ? (0, _merchant.refundOrderListApi)(this.$route.params.id, this.tableFrom).then(function (res) {\n        _this7.tableDataRefund.data = res.data.list;\n        _this7.tableDataRefund.total = res.data.count;\n        _this7.listLoading = false;\n      }).catch(function (res) {\n        _this7.listLoading = false;\n\n        _this7.$message.error(res.message);\n      }) : (0, _accounts.reconciliationRefundApi)(this.$route.params.id, this.tableFrom).then(function (res) {\n        _this7.tableDataRefund.data = res.data.list;\n        _this7.tableDataRefund.total = res.data.count;\n        _this7.listLoading = false;\n      }).catch(function (res) {\n        _this7.listLoading = false;\n\n        _this7.$message.error(res.message);\n      });\n    },\n    pageChangeRefund: function pageChangeRefund(page) {\n      this.tableFrom.page = page;\n      this.getRefundList();\n    },\n    handleSizeChangeRefund: function handleSizeChangeRefund(val) {\n      this.tableFrom.limit = val;\n      this.getRefundList();\n    },\n    setTagsViewTitle: function setTagsViewTitle() {\n      var title = '查看订单';\n      var route = Object.assign({}, this.tempRoute, {\n        title: \"\".concat(title, \"-\").concat(this.$route.params.id)\n      });\n      this.$store.dispatch('tagsView/updateVisitedView', route);\n    }\n  }\n};\nexports.default = _default;",null]}