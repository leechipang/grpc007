{"remainingRequest":"D:\\phpstudy_pro\\WWW\\master\\view\\admin\\node_modules\\babel-loader\\lib\\index.js!D:\\phpstudy_pro\\WWW\\master\\view\\admin\\node_modules\\eslint-loader\\index.js??ref--13-0!D:\\phpstudy_pro\\WWW\\master\\view\\admin\\src\\libs\\notice.js","dependencies":[{"path":"D:\\phpstudy_pro\\WWW\\master\\view\\admin\\src\\libs\\notice.js","mtime":1594785735000},{"path":"D:\\phpstudy_pro\\WWW\\master\\view\\admin\\node_modules\\cache-loader\\dist\\cjs.js","mtime":499162500000},{"path":"D:\\phpstudy_pro\\WWW\\master\\view\\admin\\node_modules\\babel-loader\\lib\\index.js","mtime":315532800000},{"path":"D:\\phpstudy_pro\\WWW\\master\\view\\admin\\node_modules\\eslint-loader\\index.js","mtime":499162500000}],"contextDependencies":[],"result":["\"use strict\";\n\nvar _interopRequireDefault = require(\"D:/phpstudy_pro/WWW/master/view/admin/node_modules/@babel/runtime/helpers/interopRequireDefault\");\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.default = void 0;\n\nvar _settingMer = _interopRequireDefault(require(\"@/libs/settingMer\"));\n\nvar _vue = _interopRequireDefault(require(\"vue\"));\n\nfunction bindEvent(vm) {\n  vm.$on('notice', function (data) {\n    this.$notify.info({\n      title: data.title || '消息',\n      message: data.message,\n      onClick: function onClick() {\n        console.log('click');\n      }\n    });\n  });\n}\n\nfunction createWebScoket(token) {\n  return new WebSocket(\"\".concat(_settingMer.default.wsSocketUrl, \"?type=admin&token=\").concat(token));\n}\n\nfunction notice(token) {\n  var ws = createWebScoket(token);\n  var vm = new _vue.default();\n  var ping;\n\n  function send(type, data) {\n    ws.send(JSON.stringify({\n      type: type,\n      data: data\n    }));\n  }\n\n  ws.onopen = function () {\n    vm.$emit('open');\n    ping = setInterval(function () {\n      send('ping');\n    }, 10000);\n  };\n\n  ws.onmessage = function (res) {\n    vm.$emit('message', res);\n    var data = JSON.parse(res.data);\n\n    if (data.status === 200) {\n      vm.$emit(data.data.status, data.data.result);\n    }\n\n    console.log(res);\n  };\n\n  ws.onclose = function (e) {\n    vm.$emit('close', e);\n    console.log('on close');\n    clearInterval(ping);\n  };\n\n  bindEvent(vm);\n  return function () {\n    ws.close();\n  };\n}\n\nvar _default = notice;\nexports.default = _default;",null]}