{"remainingRequest":"D:\\phpstudy_pro\\WWW\\master\\view\\admin\\node_modules\\babel-loader\\lib\\index.js!D:\\phpstudy_pro\\WWW\\master\\view\\admin\\node_modules\\cache-loader\\dist\\cjs.js??ref--0-0!D:\\phpstudy_pro\\WWW\\master\\view\\admin\\node_modules\\vue-loader\\lib\\index.js??vue-loader-options!D:\\phpstudy_pro\\WWW\\master\\view\\admin\\src\\components\\uploadPicture\\index.vue?vue&type=script&lang=js&","dependencies":[{"path":"D:\\phpstudy_pro\\WWW\\master\\view\\admin\\src\\components\\uploadPicture\\index.vue","mtime":1612255397000},{"path":"D:\\phpstudy_pro\\WWW\\master\\view\\admin\\node_modules\\cache-loader\\dist\\cjs.js","mtime":499162500000},{"path":"D:\\phpstudy_pro\\WWW\\master\\view\\admin\\node_modules\\babel-loader\\lib\\index.js","mtime":315532800000},{"path":"D:\\phpstudy_pro\\WWW\\master\\view\\admin\\node_modules\\cache-loader\\dist\\cjs.js","mtime":499162500000},{"path":"D:\\phpstudy_pro\\WWW\\master\\view\\admin\\node_modules\\vue-loader\\lib\\index.js","mtime":499162500000}],"contextDependencies":[],"result":["\"use strict\";\n\nvar _interopRequireDefault = require(\"D:/phpstudy_pro/WWW/master/view/admin/node_modules/@babel/runtime/helpers/interopRequireDefault\");\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.default = void 0;\n\nrequire(\"core-js/modules/es6.set\");\n\nrequire(\"core-js/modules/es6.string.iterator\");\n\nrequire(\"core-js/modules/es6.array.from\");\n\nrequire(\"core-js/modules/web.dom.iterable\");\n\nrequire(\"regenerator-runtime/runtime\");\n\nvar _asyncToGenerator2 = _interopRequireDefault(require(\"D:/phpstudy_pro/WWW/master/view/admin/node_modules/@babel/runtime/helpers/asyncToGenerator\"));\n\nrequire(\"core-js/modules/es6.number.constructor\");\n\nvar _toConsumableArray2 = _interopRequireDefault(require(\"D:/phpstudy_pro/WWW/master/view/admin/node_modules/@babel/runtime/helpers/toConsumableArray\"));\n\nvar _interopRequireWildcard2 = _interopRequireDefault(require(\"D:/phpstudy_pro/WWW/master/view/admin/node_modules/@babel/runtime/helpers/interopRequireWildcard\"));\n\nvar _system = require(\"@/api/system\");\n\nvar _auth = require(\"@/utils/auth\");\n\nvar _settingMer = _interopRequireDefault(require(\"@/libs/settingMer\"));\n\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\nvar _default = {\n  name: \"Upload\",\n  props: {\n    isMore: {\n      type: String,\n      default: \"1\"\n    }\n  },\n  data: function data() {\n    return {\n      loading: false,\n      params: \"\",\n      sleOptions: {\n        attachment_category_name: \"\",\n        attachment_category_id: \"\"\n      },\n      list: [],\n      grid: {\n        xl: 8,\n        lg: 8,\n        md: 8,\n        sm: 8,\n        xs: 24\n      },\n      grid2: {\n        xl: 16,\n        lg: 16,\n        md: 16,\n        sm: 16,\n        xs: 24\n      },\n      filterText: \"\",\n      treeData: [],\n      treeData2: [],\n      defaultProps: {\n        children: \"children\",\n        label: \"attachment_category_name\"\n      },\n      classifyId: 0,\n      myHeaders: {\n        \"X-Token\": (0, _auth.getToken)()\n      },\n      tableData: {\n        page: 1,\n        limit: 12,\n        attachment_category_id: 0,\n        order: \"\",\n        attachment_name: \"\"\n      },\n      pictrueList: {\n        list: [],\n        total: 0\n      },\n      isShowPic: false,\n      checkPicList: [],\n      ids: [],\n      checkedMore: [],\n      checkedAll: [],\n      selectItem: [],\n      editId: \"\",\n      editName: \"\"\n    };\n  },\n  computed: {\n    fileUrl: function fileUrl() {\n      return _settingMer.default.https + \"/upload/image/\".concat(this.tableData.attachment_category_id, \"/file\");\n    }\n  },\n  watch: {\n    filterText: function filterText(val) {\n      this.$refs.tree.filter(val);\n    }\n  },\n  mounted: function mounted() {\n    this.params = this.$route && this.$route.path ? this.$route.path : \"\";\n    if (this.$route && this.$route.query.field === \"dialog\") Promise.resolve().then(function () {\n      return (0, _interopRequireWildcard2.default)(require(\"../../../public/UEditor/dialogs/internal\"));\n    });\n    this.getList();\n    this.getFileList(\"\");\n  },\n  methods: {\n    // 搜索分类\n    filterNode: function filterNode(value, data) {\n      if (!value) return true;\n      return data.attachment_category_name.indexOf(value) !== -1;\n    },\n    // 所有分类\n    getList: function getList() {\n      var _this = this;\n\n      var data = {\n        attachment_category_name: \"全部图片\",\n        attachment_category_id: 0\n      };\n      (0, _system.formatLstApi)().then(function (res) {\n        _this.treeData = res.data;\n\n        _this.treeData.unshift(data);\n\n        _this.treeData2 = (0, _toConsumableArray2.default)(_this.treeData);\n      }).catch(function (res) {\n        _this.$message.error(res.message);\n      });\n    },\n    // 编辑图片名称\n    handleEdit: function handleEdit(id, name) {\n      var _this2 = this;\n\n      if (id === this.editId) {\n        if (this.editName !== name) {\n          if (!name.trim()) {\n            this.$message.warning(\"请先输入图片名称\");\n            return;\n          }\n\n          (0, _system.picNameEditApi)(id, {\n            attachment_name: name\n          }).then(function () {\n            return _this2.getFileList(\"\");\n          });\n          this.editId = \"\";\n        } else {\n          this.editId = \"\";\n          this.editName = \"\";\n        }\n      } else {\n        this.editId = id;\n        this.editName = name;\n      }\n    },\n    // 添加分类\n    onAdd: function onAdd(id) {\n      var _this3 = this;\n\n      var config = {};\n      if (Number(id) > 0) config.formData = {\n        pid: id\n      };\n      this.$modalForm((0, _system.attachmentCreateApi)(), config).then(function (_ref) {\n        var message = _ref.message;\n\n        // this.$message.success(message)\n        _this3.getList();\n      });\n    },\n    // 编辑\n    onEdit: function onEdit(id) {\n      var _this4 = this;\n\n      this.$modalForm((0, _system.attachmentUpdateApi)(id)).then(function () {\n        return _this4.getList();\n      });\n    },\n    // 删除\n    handleDelete: function handleDelete(id) {\n      var _this5 = this;\n\n      this.$modalSure().then(function () {\n        (0, _system.attachmentDeleteApi)(id).then(function (_ref2) {\n          var message = _ref2.message;\n\n          _this5.$message.success(message);\n\n          _this5.getList();\n        }).catch(function (_ref3) {\n          var message = _ref3.message;\n\n          _this5.$message.error(message);\n        });\n      });\n    },\n    handleNodeClick: function handleNodeClick(data) {\n      this.tableData.attachment_category_id = data.attachment_category_id;\n      this.getFileList(\"\");\n    },\n    // 上传成功\n    handleSuccess: function handleSuccess(response) {\n      if (response.status === 200) {\n        this.$message.success(\"上传成功\");\n        this.getFileList(\"\");\n      } else {\n        this.$message.error(response.message);\n      }\n    },\n    // 文件列表\n    getFileList: function getFileList(num) {\n      var _this6 = this;\n\n      this.loading = true;\n      this.tableData.page = num ? num : this.tableData.page;\n      (0, _system.attachmentListApi)(this.tableData).then( /*#__PURE__*/function () {\n        var _ref4 = (0, _asyncToGenerator2.default)( /*#__PURE__*/regeneratorRuntime.mark(function _callee(res) {\n          return regeneratorRuntime.wrap(function _callee$(_context) {\n            while (1) {\n              switch (_context.prev = _context.next) {\n                case 0:\n                  _this6.pictrueList.list = res.data.list;\n\n                  if (_this6.pictrueList.list.length) {\n                    _this6.isShowPic = false;\n                  } else {\n                    _this6.isShowPic = true;\n                  }\n\n                  _this6.pictrueList.total = res.data.count;\n                  if (_this6.$route && _this6.$route.query.field && _this6.$route.query.field !== \"dialog\") _this6.checkedMore = window.form_create_helper.get(_this6.$route.query.field) || [];\n                  _this6.loading = false;\n\n                case 5:\n                case \"end\":\n                  return _context.stop();\n              }\n            }\n          }, _callee);\n        }));\n\n        return function (_x) {\n          return _ref4.apply(this, arguments);\n        };\n      }()).catch(function (res) {\n        _this6.$message.error(res.message);\n\n        _this6.loading = false;\n      });\n    },\n    pageChange: function pageChange(page) {\n      this.tableData.page = page;\n      this.selectItem = [];\n      this.checkPicList = [];\n      this.getFileList(\"\");\n    },\n    handleSizeChange: function handleSizeChange(val) {\n      this.tableData.limit = val;\n      this.getFileList(\"\");\n    },\n    // 选中图片\n    changImage: function changImage(item, index, row) {\n      var _this7 = this;\n\n      // this.$set(item, 'isSelect', item.isSelect === undefined ? true : !item.isSelect)\n      // selectItem = this.pictrueList.list.filter((item) => {\n      //   return item.isSelect === true\n      // })\n      // this.ids = []\n      // const pic = []\n      // selectItem.map((item, index) => {\n      //   this.ids.push(item.attachment_id)\n      //   pic.push(item.attachment_src)\n      // })\n      // this.checkPicList = pic\n      if (!item.isSelect) {\n        item.isSelect = true;\n        this.selectItem.push(item);\n        this.checkPicList.push(item.attachment_src);\n        this.ids.push(item.attachment_id);\n      } else {\n        item.isSelect = false;\n        var index = this.ids.indexOf(item.attachment_id);\n        if (index > -1) this.ids.splice(index, 1);\n        this.selectItem.forEach(function (o, i) {\n          if (o.attachment_id == item.attachment_id) {\n            _this7.selectItem.splice(i, 1);\n          }\n        });\n        this.checkPicList.map(function (el, index) {\n          if (el == item.attachment_src) {\n            _this7.checkPicList.splice(index, 1);\n          }\n        });\n      }\n\n      if (this.$route && this.$route.fullPath && this.$route.fullPath !== \"/admin/config/picture\" || !this.$route) {\n        this.pictrueList.list.map(function (el, i) {\n          if (el.isSelect) {\n            _this7.selectItem.filter(function (el2, j) {\n              if (el.attachment_id == el2.attachment_id) {\n                el.num = j + 1;\n              }\n            });\n          } else {\n            el.num = 0;\n          }\n        });\n      }\n    },\n    // 点击使用选中图片\n    checkPics: function checkPics() {\n      if (this.checkPicList.length) {\n        if (this.$route) {\n          if (this.$route.query.type === \"1\") {\n            if (this.checkPicList.length > 1) return this.$message.warning(\"最多只能选一张图片\");\n            /* eslint-disable */\n\n            form_create_helper.set(this.$route.query.field, this.checkPicList[0]);\n            form_create_helper.close(this.$route.query.field);\n          }\n\n          if (this.$route.query.type === \"2\") {\n            this.checkedAll = [].concat((0, _toConsumableArray2.default)(this.checkedMore), (0, _toConsumableArray2.default)(this.checkPicList));\n            form_create_helper.set(this.$route.query.field, Array.from(new Set(this.checkedAll)));\n            form_create_helper.close(this.$route.query.field);\n          }\n\n          if (this.$route.query.field === \"dialog\") {\n            var str = \"\";\n\n            for (var i = 0; i < this.checkPicList.length; i++) {\n              str += '<img src=\"' + this.checkPicList[i] + '\">';\n            }\n            /* eslint-disable */\n\n\n            nowEditor.editor.execCommand(\"insertHtml\", str);\n            nowEditor.dialog.close(true); // nowEditor.editor.setContent(str, true)\n          }\n        } else {\n          if (this.isMore === \"1\" && this.checkPicList.length > 1) {\n            return this.$message.warning(\"最多只能选一张图片\");\n          }\n\n          this.$emit(\"getImage\", this.checkPicList);\n        }\n      } else {\n        this.$message.warning(\"请先选择图片\");\n      }\n    },\n    // 删除图片\n    editPicList: function editPicList(tit) {\n      var _this8 = this;\n\n      var ids = {\n        ids: this.ids\n      };\n      this.$modalSure().then(function () {\n        (0, _system.picDeleteApi)(ids).then(function (_ref5) {\n          var message = _ref5.message;\n\n          _this8.$message.success(message);\n\n          _this8.getFileList(\"\");\n\n          _this8.checkPicList = [];\n        }).catch(function (_ref6) {\n          var message = _ref6.message;\n\n          _this8.$message.error(message);\n        });\n      });\n    },\n    // 移动分类点击\n    handleSelClick: function handleSelClick(node) {\n      if (this.ids.length) {\n        this.sleOptions = {\n          attachment_category_name: node.attachment_category_name,\n          attachment_category_id: node.attachment_category_id\n        };\n        this.getMove();\n      } else {\n        this.$message.warning(\"请先选择图片\");\n      }\n    },\n    getMove: function getMove() {\n      var _this9 = this;\n\n      (0, _system.categoryApi)(this.ids, this.sleOptions.attachment_category_id).then( /*#__PURE__*/function () {\n        var _ref7 = (0, _asyncToGenerator2.default)( /*#__PURE__*/regeneratorRuntime.mark(function _callee2(res) {\n          return regeneratorRuntime.wrap(function _callee2$(_context2) {\n            while (1) {\n              switch (_context2.prev = _context2.next) {\n                case 0:\n                  _this9.$message.success(res.message);\n\n                  _this9.clearBoth();\n\n                  _this9.getFileList(\"\");\n\n                case 3:\n                case \"end\":\n                  return _context2.stop();\n              }\n            }\n          }, _callee2);\n        }));\n\n        return function (_x2) {\n          return _ref7.apply(this, arguments);\n        };\n      }()).catch(function (res) {\n        _this9.clearBoth();\n\n        _this9.$message.error(res.message);\n      });\n    },\n    clearBoth: function clearBoth() {\n      this.sleOptions = {\n        attachment_category_name: \"\",\n        attachment_category_id: \"\"\n      };\n      this.checkPicList = [];\n      this.ids = [];\n    }\n  }\n};\nexports.default = _default;",null]}