{"remainingRequest":"D:\\phpstudy_pro\\WWW\\master\\view\\admin\\node_modules\\babel-loader\\lib\\index.js!D:\\phpstudy_pro\\WWW\\master\\view\\admin\\node_modules\\eslint-loader\\index.js??ref--13-0!D:\\phpstudy_pro\\WWW\\master\\view\\admin\\src\\libs\\modal-form.js","dependencies":[{"path":"D:\\phpstudy_pro\\WWW\\master\\view\\admin\\src\\libs\\modal-form.js","mtime":1601293043000},{"path":"D:\\phpstudy_pro\\WWW\\master\\view\\admin\\node_modules\\cache-loader\\dist\\cjs.js","mtime":499162500000},{"path":"D:\\phpstudy_pro\\WWW\\master\\view\\admin\\node_modules\\babel-loader\\lib\\index.js","mtime":315532800000},{"path":"D:\\phpstudy_pro\\WWW\\master\\view\\admin\\node_modules\\eslint-loader\\index.js","mtime":499162500000}],"contextDependencies":[],"result":["\"use strict\";\n\nvar _interopRequireDefault = require(\"D:/phpstudy_pro/WWW/master/view/admin/node_modules/@babel/runtime/helpers/interopRequireDefault\");\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.default = modalForm;\n\nvar _objectSpread2 = _interopRequireDefault(require(\"D:/phpstudy_pro/WWW/master/view/admin/node_modules/@babel/runtime/helpers/objectSpread2\"));\n\nvar _request = _interopRequireDefault(require(\"@/api/request\"));\n\nvar _vue = _interopRequireDefault(require(\"vue\"));\n\nvar fApi;\nvar unique = 1;\n\nvar uniqueId = function uniqueId() {\n  return ++unique;\n};\n\nfunction modalForm(formRequestPromise) {\n  var _this = this;\n\n  var config = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : {};\n  var h = this.$createElement;\n  return new Promise(function (resolve, reject) {\n    formRequestPromise.then(function (_ref) {\n      var data = _ref.data;\n      data.config.submitBtn = false;\n      data.config.resetBtn = false;\n      if (!data.config.form) data.config.form = {};\n      if (!data.config.formData) data.config.formData = {};\n      data.config.formData = (0, _objectSpread2.default)((0, _objectSpread2.default)({}, data.config.formData), config.formData);\n      data.config.form.labelWidth = '120px';\n      data.config.global = {\n        upload: {\n          props: {\n            onSuccess: function onSuccess(rep, file) {\n              if (rep.status === 200) {\n                file.url = rep.data.src;\n              }\n            }\n          }\n        }\n      };\n      data = _vue.default.observable(data);\n\n      _this.$msgbox({\n        title: data.title,\n        customClass: config.class || 'modal-form',\n        message: h('div', {\n          class: 'common-form-create',\n          key: uniqueId()\n        }, [h('formCreate', {\n          props: {\n            rule: data.rule,\n            option: data.config\n          },\n          on: {\n            mounted: function mounted($f) {\n              fApi = $f;\n            }\n          }\n        })]),\n        beforeClose: function beforeClose(action, instance, done) {\n          var fn = function fn() {\n            setTimeout(function () {\n              instance.confirmButtonLoading = false;\n            }, 500);\n          };\n\n          if (action === 'confirm') {\n            instance.confirmButtonLoading = true;\n            fApi.submit(function (formData) {\n              _request.default[data.method.toLowerCase()](data.action.slice(5), formData).then(function (res) {\n                done();\n\n                _this.$message.success(res.message || '提交成功');\n\n                resolve(res);\n              }).catch(function (err) {\n                _this.$message.error(err.message || '提交失败');\n\n                reject(err);\n              }).finally(function () {\n                fn();\n              });\n            }, function () {\n              return fn();\n            });\n          } else {\n            fn();\n            done();\n          }\n        }\n      });\n    }).catch(function (e) {\n      _this.$message.error(e.message);\n    });\n  });\n}",null]}